<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang="ja-JP">
<head>
<title>Just another Ruby porter, 2003-5-c</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="generator" content="nsmm v0.6.3.2(2005/08/18)">
<meta name="author" content="わたなべひろふみ">
<meta http-equiv="Content-Style-Type" content="text/css">
<META http-equiv="Content-Script-Type" content="text/javascript">
<link rel="stylesheet" href="../css/basic.css" type="text/css" media="all">
<link rel="shortcut icon" type="image/x-icon" href="../favicon.ico">
<link rel="icon" type="image/png" href="../favicon.png">
<link rel="alternate" type="application/rss+xml" title="RSS" href="https://jarp.does.notwork.org/jarp/diary/index.rdf">
<link rev="made" href="&#109;&#x61;&#x69;&#108;&#116;&#111;&#x3A;&#101;&#98;&#x61;&#110;&#64;&#x6F;&#x73;&#x2E;&#x72;&#105;&#109;&#46;&#x6F;&#x72;&#x2E;&#106;&#x70;">
<link rel="index" href="./">
<link rel="prev" href="200305b.html">
<link rel="next" href="200306a.html">

<link rel="stylesheet" type="text/css" href="http://google-code-prettify.googlecode.com/svn/trunk/src/prettify.css">
<script async type="text/javascript" src="http://google-code-prettify.googlecode.com/svn/trunk/src/prettify.js"></script>
<script type="text/javascript">
<!--       
$(document).ready(function() {
  prettyPrint();
});
-->
</script>
</head>
<body>
<div><h1><span>Just another Ruby porter,</span></h1></div>

<p>〜2003年5月下旬〜</p>
<hr>
<div>
<a href="200305b.html" accesskey=",">&lt;Older(,)</a> | 
<a href="200306a.html" accesskey=".">Newer(.)&gt;</a> | 
<a href="index.html" accesskey="/">Recent(/)&gt;&gt;</a>
| <a href="index.rdf">RDF</a>
</div>

<hr>

<!-- 2003/05/21 start -->
<h2><a name="20030521" href="200305c.html#20030521">2003-05-21 (Wed)</a></h2>

<div class="entry1">
<h3><a name="200305211" title="200305211" href="200305c.html#200305211">■</a> 
<a href="http://www.cam.hi-ho.ne.jp/oishi/">[Windows] XKeymacs</a></h3>
<p>
キーボードのレイアウトも変更できるし、設定は簡単だし、よさそうだ。
</p>

<!-- section end -->
</div>

<div class="entry0">
<h3><a name="200305212" title="200305212" href="200305c.html#200305212">■</a> 
<a href="http://raa.ruby-lang.org/project/ruby-google/">[Ruby] ruby-google 0.5.1</a></h3>
<p>
更新。
</p>

<!-- section end -->
</div>

<div class="entry1">
<h3><a name="200305213" title="200305213" href="200305c.html#200305213">■</a> 
<a href="http://raa.ruby-lang.org/project/bdb/">[Ruby] bdb 0.4.2</a></h3>
<p>
更新。
</p>
<!-- section end -->
</div>
<!-- 2003/05/21 end -->



<hr class="hide">
<!-- 2003/05/22 start -->
<h2><a name="20030522" href="200305c.html#20030522">2003-05-22 (Thu)</a></h2>

<div class="entry1">
<h3><a name="200305221" title="200305221" href="200305c.html#200305221">■</a> 
<a href="http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-dev/20268">[Ruby] *1..1</a></h3>
<p>
また元の仕様に戻った。
</p>
<pre>
% ruby -ve 'p(*1..1)' 
ruby 1.8.0 (2003-05-22) [i386-linux]
1
</pre>

<!-- section end -->
</div>

<div class="entry0">
<h3><a name="200305222" title="200305222" href="200305c.html#200305222">■</a> 
<a href="200205a.html#200205092">inetd.co.jp</a></h3>
<p>
今月で切れる。さてどうしようかな。
</p>
<!-- section end -->
</div>
<!-- 2003/05/22 end -->



<hr class="hide">
<!-- 2003/05/23 start -->
<h2><a name="20030523" href="200305c.html#20030523">2003-05-23 (Fri)</a></h2>

<div class="entry1">
<h3><a name="200305231" title="200305231" href="200305c.html#200305231">■</a> 
<a href="http://www.openoffice.org/">[Win32] OpenOffice 1.1beta2</a></h3>
<p>
表示されるフォントが1.1beta1と比べるとちょっと変わったようだ。
でも1.1beta1からはフォントの設定をいじらなくても日本語を扱えるから楽だよね。
Export as PDFがかなり役立っている。
メニュー等の表示が英語になってしまうのが気にならなければ十分このままで使える。
</p>
<!-- section end -->
</div>
<!-- 2003/05/23 end -->



<hr class="hide">
<!-- 2003/05/24 start -->
<h2><a name="20030524" href="200305c.html#20030524">2003-05-24 (Sat)</a></h2>

<div class="entry1">
<h3><a name="200305241" title="200305241" href="200305c.html#200305241">■</a> 
[Windows 2000] キーボード配列(US配列)</h3>
<p>
自分の好みはUS配列で、ESCは1の左、ControlはAの左、`はReturnの左。
つまりNEWSやAXのキー配列だ。
</p>

<p>
自分の思い通りに設定するには
<a href="http://mayu.sf.net/">窓使いの憂鬱</a>を使うのが柔軟性もあっていいのだが、実は先日のトラブルの際、
C:\Program Filesのバックアップは取っていなかったため、
あれこれ設定した内容が失われてしまった。
全部~/.mayuに書いとけばねえと今さら言っても遅い。
また設定しなおしてもいいんだけど、
別の方法を探ってみよう。
</p>

<p>
Windows 2000でUS配列を実現するには簡単で、
コントロールパネル-キーボード-入力ロケールで追加(D)ボタンを押して、
入力ロケール(I)で英語(US)を選べばいい。
これで入力ロケールのホットキーが左Alt+Shiftになるので、
ホットキーでトグルになる。
ただし、US配列になるのは英語(US)に切り替えたときだけなので、
日本語入力時にはまた戻ってしまう。これではいまいち使えない。
プロパティ(P)のキーボード レイアウト/入力システム(K)で米国を選ぶと、
今度はIMEを起動できない。これはXKeymacsでC-oとかに割り当ててもだめ。
</p>

<p>
「キー」「配列」「変更」「windows 2000」でぐぐってみると、
面白い記述が見つかった。日本語106/109USB接続のキーボードがなぜか101配列
で動作してしまうという不具合だ。
これは101配列と同じPnP IDの106配列のキーボードが接続された場合に、
101キーボードと認識されてしまうため。対処としてはレジストリで
</p>
<pre>
 [HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\i8042prt\Parameters]
 &quot;LayerDriver JPN&quot;=&quot;kbd101.dll&quot;
</pre>
<p>
のkdb101.dllをkbd106.kbdに変更せよとあった。なるほど。
つまりおいらの場合はこの逆をすればいいわけだ。書き換えてリブート。okだ。
US配列に関してはこれで解決。
</p>
<!-- section end -->
</div>
<!-- 2003/05/24 end -->



<hr class="hide">
<!-- 2003/05/25 start -->
<h2><a name="20030525" href="200305c.html#20030525">2003-05-25 (Sun)</a></h2>

<div class="entry1">
<h3><a name="200305251" title="200305251" href="200305c.html#200305251">■</a> 
[Windows 2000] キーボード配列(XKeymacs)</h3>
<p>
昨日の続き。あとはESC、Contrl、`の個別対応だけど、これは
<a href="http://www.cam.hi-ho.ne.jp/oishi/">XKeymacs</a>のキーボードレイアウトで変更する。
上のキーボードから下のキーボードへDnDするだけなので簡単。
実際は
</p>
<pre>
[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Keyboard Layout]
&quot;Scancode Map&quot;
</pre>
<p>
を書き換えることになるので、administrator権限が必要。
つまりXKeymacsじゃなくても直接regeditでいじってもいい。
そのあたりの情報もぐぐるといっぱい出てくる。
</p>

<!-- section end -->
</div>

<div class="entry0">
<h3><a name="200305252" title="200305252" href="200305c.html#200305252">■</a> 
[Windows 2000] Acrobat Reader 5.1</h3>
<p>
ついでにXkeymacsのカスタマイズを使いAcrobat Readerでスペースバーがscroll-upになるように割り当てた。
それにしてもAcrobat Readerってなぜスペースバーが遊んでるんだろう？
もったいない。
</p>

<p>
ついでのついでに、j, k, g, G, /も割り当ててlessのようにしてみる。
おぉ、いいじゃん。
</p>

<!-- section end -->
</div>

<div class="entry1">
<h3><a name="200305253" title="200305253" href="200305c.html#200305253">■</a> 
<a href="http://www.openoffice.org/">[Windows 2000] OpenOffice.org 1.1beta2</a></h3>
<p>
PDFに変換すると[や]などの記号が90度右へ回転してしまう。うーむ。
</p>
<!-- section end -->
</div>
<!-- 2003/05/25 end -->



<hr class="hide">
<!-- 2003/05/26 start -->
<h2><a name="20030526" href="200305c.html#20030526">2003-05-26 (Mon)</a></h2>

<div class="entry1">
<h3><a name="200305261" title="200305261" href="200305c.html#200305261">■</a> 
[Windows 2000] kdbax2.dll</h3>
<p>
会社ではAXキーボードを10年ほど使っているけど、
Windows 2000になってから選択枝にAXキーボードがなくなってしまった。
<a href="200305c.html#200305241">一昨日の件</a>で、いろいろ見てたらkbdax2.dllを発見。
プロパティでバージョン情報を見てみると
</p>
<pre>
JP Japanese Keyboard Layout for AX2
</pre>
<p>
とあった。試すとちゃんと使える。いままでは
<a href="http://mayu.sf.net/">窓使いの憂鬱</a>でいろいろいじっていただけにこれで楽になったね。
ついでに会社も
<a href="http://www.cam.hi-ho.ne.jp/oishi/">XKeymacs</a>に乗り換え。
</p>

<!-- section end -->
</div>

<div class="entry0">
<h3><a name="200305262" title="200305262" href="200305c.html#200305262">■</a> 
[Windows 2000] Scancode Map</h3>
<p>
変更したレジストリの内容を残しておこう。
</p>
<pre>
REGEDIT4

[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Keyboard Layout]
&quot;Scancode Map&quot;=hex:00,00,00,00,00,00,00,00,07,00,00,00,38,00,1d,00,\
  01,00,29,00,29,00,2b,00,1d,00,3a,00,2b,00,73,00,2b,00,7d,00,00,00,00,00
</pre>

<!-- section end -->
</div>
<!-- 2003/05/26 end -->



<hr class="hide">
<!-- 2003/05/27 start -->
<h2><a name="20030527" href="200305c.html#20030527">2003-05-27 (Tue)</a></h2>

<div class="entry1">
<h3><a name="200305271" title="200305271" href="200305c.html#200305271">■</a> 
[MSYS][MinGW][Ruby] monolithic executable</h3>
<p>
インド人からお便りをもらう。とにかく
<a href="http://www.mingw.org/">MinGW</a>と
<a href="http://www.mingw.org/msys.shtml">MSYS</a>でやりたいんだよろしくってことらしい。
</p>
<pre>
I want to compile ruby on mingw by myself, with no DLL's etc,
ONLY one monolithic executable of ruby. Is it possible to do so?
</pre>
<p>
1.6なら特に何も考えずにconfigureすればいいし、
1.8なら--disable-sharedつきで。
あとはREADMEに書いてある通りext/Setupを編集して、
最初の行の#option nodynamicと望みの拡張ライブラリのコメントを外せばいい。
</p>

<p>
でもbisonがないからCVSからRubyのソースを取ってきた場合は注意。
</p>

<p>
と思ったら、1.8では-DRUBY_EXPORTをつけないと拡張ライブラリをスタティックにリンクできない。
今までと逆になるから、CCDLFLAGSってわけにはいかないし、ちょっと困ったな。
</p>

<!-- section end -->
</div>
<!-- 2003/05/27 end -->



<hr class="hide">
<!-- 2003/05/28 start -->
<h2><a name="20030528" href="200305c.html#20030528">2003-05-28 (Wed)</a></h2>

<div class="entry1">
<h3><a name="200305281" title="200305281" href="200305c.html#200305281">■</a> 
[Ruby][MinGW] EXTERN_C _CRTIMP ioinfo * __pioinfo[];</h3>
<p>
最新のMinGWで環境でこける
<a href="200305b.html#200305131">件</a>を調べた。-D__USE_CRTIMP -Eした結果から、
__attribute__((dllimport))を二分法で削除していったら、win32/win32.cの
</p>
<pre>
EXTERN_C _CRTIMP ioinfo * __pioinfo[];
</pre>
<p>
が原因であることがわかった。_CRTIMPが定義されてなければ
</p>
<pre>
#if !defined _CRTIMP
#define _CRTIMP __declspec(dllimport)
#endif
</pre>
<p>
なのでいいんだが、今回のMinGW側の変更で/usr/include/mingw/_mingw.hが
</p>
<pre>
#  ifndef _CRTIMP
#   ifdef __USE_CRTIMP
#    define _CRTIMP  __attribute__((dllimport))
#   else  
#    define _CRTIMP
#   endif
</pre>
<p>
となったため、-D__USE_CRTIMPをつけないと
</p>
<pre>
#    define _CRTIMP
</pre>
<p>
が生き残る。最終的には
</p>
<pre>
extern ioinfo * __pioinfo[];
</pre>
<p>
という宣言でmsvcrt.dllにあるこの変数をアクセスしてしまうので落ちてしまうわけだ。
MinGWではlibc相当を静的にリンクするという選択枝はない以上、
必ずdllimportにならないと困るわけで
</p>
<pre>
#if !defined _CRTIMP || defined __MINGW32__
#undef _CRTIMP
#define _CRTIMP __declspec(dllimport)
#endif
</pre>
<p>
とすればよさそう。これで-D__USE_CRTIMPは削除できる。
</p>

<!-- section end -->
</div>

<div class="entry0">
<h3><a name="200305282" title="200305282" href="200305c.html#200305282">■</a> 
<a href="200305b.html#200305151">[Ruby] pipe_exec()</a></h3>
<p>
1.6と1.8のpipe_exec()に違いがないなどと書いているが、
1.6にはpipe_exec()などない。おれは何と比較したんだ？
</p>

<!-- section end -->
</div>

<div class="entry1">
<h3><a name="200305283" title="200305283" href="200305c.html#200305283">■</a> 
<a href="http://www.nongnu.org/cvs/">[Linux] CVS 1.11.6</a></h3>
<p>
更新。
</p>
<!-- section end -->
</div>
<!-- 2003/05/28 end -->



<hr class="hide">
<!-- 2003/05/29 start -->
<h2><a name="20030529" href="200305c.html#20030529">2003-05-29 (Thu)</a></h2>

<div class="entry1">
<h3><a name="200305291" title="200305291" href="200305c.html#200305291">■</a> 
<a href="ftp://alpha.gnu.org/gnu/findutils/">[GNU] findutils 4.1.20</a></h3>
<p>
会社のLinux BoxはまだPlamo 2だった。
locate -i(--ignore-case)が使いたくてインストール。
</p>
<pre>
% CFLAGS=-Os ./configure \
  --prefix=/usr --disable-nls --localstatedir=/var/locate
</pre>

<!-- section end -->
</div>
<!-- 2003/05/29 end -->



<hr class="hide">
<!-- 2003/05/30 start -->
<h2><a name="20030530" href="200305c.html#20030530">2003-05-30 (Fri)</a></h2>

<div class="entry1">
<h3><a name="200305301" title="200305301" href="200305c.html#200305301">■</a> 
[Cygwin][MinGW] gcc -fnative-struct vs. gcc -mms-bitfileds</h3>
<p>
なんでgcc 3.xで-fnative-structが実装されないんだと思ったら、
-mms-bitfieldsという名前になったらしい。
</p>
<pre>
`-mms-bitfields'
     If set, RECORD_TYPE bit-fields are laid out following the rules of
     Microsoft Visual C/C++, namely: (i) a bit-field won't share the
     same storage unit with the previous bit-field if their underlying
     types have different sizes, and the bit-field will be aligned to
     the highest alignment of the underlying types of itself and of the
     previous bit-field; (ii) a zero-sized bit-field will affect the
     alignment of the whole enclosing structure, even if it is unnamed;
     except that (iii) a zero-sized bit-field will be disregarded
     unless it follows another bit-field of non-zero size. Currently,
     this option is supported on `cygwin' and `mingw32'.
</pre>

<!-- section end -->
</div>
<!-- 2003/05/30 end -->



<hr class="hide">
<!-- 2003/05/31 start -->
<h2><a name="20030531" href="200305c.html#20030531">2003-05-31 (Sat)</a></h2>

<div class="entry1">
<h3><a name="200305311" title="200305311" href="200305c.html#200305311">■</a> 
[Ruby][MinGW][Cygwin] -DRUBY_EXPORTとRUBY_EXTERN</h3>
<p>
auto importを使えばdllimportする必要もないので、
</p>
<pre>
#define RUBY_EXTERN extern
</pre>
<p>
となるようにdefines.hを変更して実験してみる。
</p>
<pre>
% ./ruby -r./ext/Win32API/Win32API -e0
./ext/Win32API/Win32API.so: wrong argument type Fixnum (expected Class) (TypeError)
</pre>
<p>
rb_cObjectがちゃんと伝わっていない。
ってことはauto importがうまく機能してないな。
というよりauto importをちゃんと調べよう。
ライブラリの作り方に秘密があるに違いない。
</p>

<p>
1.6だとrb_class_new()にCheck_Type(super, T_CLASS);がないので、
そのまま落ちているパターンだ。
</p>
<!-- section end -->
</div>
<!-- 2003/05/31 end -->

<hr>
<div>
<a href="200305b.html">&lt;Older(,)</a> | 
<a href="200306a.html">Newer(.)&gt;</a> | 
<a href="index.html">Recent(/)&gt;&gt;</a>
| <a href="index.rdf">RDF</a>
</div>

<hr>
<!-- SiteSearch Google -->
<form method=GET action="http://www.google.co.jp/search">
<p>
<input type=text name=q size=31 maxlength=255 value="">
<input type=hidden name=hl value="ja">
<input type=hidden name=ie value="UTF-8">
<input type=submit name=btnG value="Google 検索">
<input type=hidden name=domains value="jarp.does.notwork.org"><br>
<input type=radio name=sitesearch value=""> WWW を検索
<input type=radio name=sitesearch value="jarp.does.notwork.org" checked> jarp.does.notwork.org を検索 <br>
</form>

<!-- nsmm v0.6.3.2(2005/08/18) -->

<address><a href="&#109;&#x61;&#x69;&#108;&#116;&#111;&#x3A;&#101;&#98;&#x61;&#110;&#64;&#x6F;&#x73;&#x2E;&#x72;&#105;&#109;&#46;&#x6F;&#x72;&#x2E;&#106;&#x70;">わたなべひろふみ</a><br>
Key fingerprint = C456 1350 085F A320 C6C8  8A36 0F15 9B2E EB12 3885<br>
      <a href="http://validator.w3.org/check?uri=referer"><img
          src="http://www.w3.org/Icons/valid-html401"
          alt="Valid HTML 4.01!" height="16" width="88"></a>

<script type="text/javascript" src="http://trackfeed.com/usr/aa7471e560.js"></script>
</address>

<script src="http://www.google-analytics.com/urchin.js" type="text/javascript">
</script>
<script type="text/javascript">
<!--
_uacct = "UA-101613-1";
urchinTracker();
// -->
</script>
<script src="title.js" type="text/javascript">
</script>
</body>
</html>
