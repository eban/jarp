<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "https://www.w3.org/TR/html4/strict.dtd">
<html lang="ja-JP">
<head>
<title>Just another Ruby porter, 2001-6-b</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="generator" content="nsmm v0.6.3.2(2005/08/18)">
<meta name="author" content="わたなべひろふみ">
<meta http-equiv="Content-Style-Type" content="text/css">
<META http-equiv="Content-Script-Type" content="text/javascript">
<link rel="stylesheet" href="../css/basic.css" type="text/css" media="all">
<link rel="shortcut icon" type="image/x-icon" href="../favicon.ico">
<link rel="icon" type="image/png" href="../favicon.png">
<link rel="alternate" type="application/rss+xml" title="RSS" href="https://jarp.does.notwork.org/jarp/diary/index.rdf">
<link rev="made" href="&#109;&#x61;&#x69;&#108;&#116;&#111;&#x3A;&#101;&#98;&#x61;&#110;&#64;&#x6F;&#x73;&#x2E;&#x72;&#105;&#109;&#46;&#x6F;&#x72;&#x2E;&#106;&#x70;">
<link rel="index" href="./">
<link rel="prev" href="200106a.html">
<link rel="next" href="200106c.html">

</head>
<body>
<div><h1><span>Just another Ruby porter,</span></h1></div>

<p>〜2001年6月中旬〜</p>
<hr>
<div>
<a href="200106a.html" accesskey=",">&lt;Prev(,)</a> | 
<a href="200106c.html" accesskey=".">Next(.)&gt;</a> | 
<a href="index.html" accesskey="/">Recent(/)&gt;&gt;</a>
| <a href="index.rdf">RDF</a>
</div>

<hr>

<!-- 2001/06/11 start -->
<h2><a name="20010611" href="200106b.html#20010611">2001-06-11 (Mon)</a></h2>

<div class="entry1">
<h3><a name="200106111" title="200106111" href="200106b.html#200106111">■</a> 
<a href="200106a.html#200106102">RUBY_CANONICAL_BUILD</a></h3>
<p>
結局RUBY_CANONICAL_BUILDを作った。
autoconf 2.50の場合、
</p>
<pre>
AC_CANONICAL_TARGET
AC_CANONICAL_HOST
AC_CANONICAL_BUILD
</pre>
<p>
は
</p>
<pre>
AC_CANONICAL_SYSTEM
</pre>
<p>
とほとんど同じなので、
--targetを指定したら--program-prifix=''も忘れずに。
</p>

<p>
1.7.xはこんな小細工はやめてAC_CANONICAL_SYSTEMにしちゃおう。
</p>

<!-- section end -->
</div>

<div class="entry0">
<h3><a name="200106112" title="200106112" href="200106b.html#200106112">■</a> 
フローラン・ダバディー(日本代表監督トルシエのパーソナルアシスタント)</h3>
<p>
そんな肩書を持ってたのか。
</p>


<!-- section end -->
</div>
<!-- 2001/06/11 end -->



<hr class="hide">
<!-- 2001/06/12 start -->
<h2><a name="20010612" href="200106b.html#20010612">2001-06-12 (Tue)</a></h2>

<div class="entry1">
<h3><a name="200106121" title="200106121" href="200106b.html#200106121">■</a> 
ruby-talk</h3>
<p>
分離の影響か先月の半分ぐらいの流量になってる。
</p>

<!-- section end -->
</div>

<div class="entry0">
<h3><a name="200106122" title="200106122" href="200106b.html#200106122">■</a> 
[Cygwin] setup.exe</h3>
<p>
なにげなくCygwinのsetup.exeのソースを見てたら、
tar.bz2もサポートしてることがわかった。
そういえば以前tar.gzだとWinzipで展開する人が多いから
<a href="#20010612F1"><sup><small>*1</small></sup></a>、
tar.bz2にしよっかななんてChrisがCygwin MLで言ってたような。
</p>

<hr align="left" width="40%">
<div>
<a name="20010612F1" href="200106b.html#20010612F1"><small>*1</small></a>:
symlinkを考えるとCygwinのtarを使わないとまずい。
</div>
<!-- section end -->
</div>

<div class="entry1">
<h3><a name="200106123" title="200106123" href="200106b.html#200106123">■</a> 
rubywin 0.0.3.2</h3>
<p>
すっかり忘れてた。更新。
</p>


<!-- section end -->
</div>
<!-- 2001/06/12 end -->



<hr class="hide">
<!-- 2001/06/13 start -->
<h2><a name="20010613" href="200106b.html#20010613">2001-06-13 (Wed)</a></h2>

<div class="entry1">
<h3><a name="200106131" title="200106131" href="200106b.html#200106131">■</a> 
[Cygwin] automode.o</h3>
<p>
/lib/automode.oをリンクするとmountのモードに関わらずに
</p>
<pre>
入力側はtext mode
出力側はbinary tmode
</pre>
<p>
になる。pdkshにこれをリンクしてみたがいい感じ。
ソースに手を入れずにこれですめば実にお手軽。
</p>


<!-- section end -->
</div>
<!-- 2001/06/13 end -->



<hr class="hide">
<!-- 2001/06/14 start -->
<h2><a name="20010614" href="200106b.html#20010614">2001-06-14 (Thu)</a></h2>

<div class="entry1">
<h3><a name="200106141" title="200106141" href="200106b.html#200106141">■</a> 
wget 1.7.0</h3>
<p>
SSL supportが入ったので使ってみたくなる。
</p>
<pre>
% ./configure --with-ssl=/usr/local/ssl
&lt;前略&gt;
Looking for SSL libraries in /usr/local/ssl
checking for RSA_new in -lcrypto... no
checking for SSL_new in -lssl... no

WARNING: Failed to link with OpenSSL libraries in /usr/local/ssl/lib.
         Wget will be built without support for https://... URLs.
&lt;後略&gt;
</pre>
<p>
となぜか見つけてくれない。ちゃんとあるのに。
</p>
<pre>
% ls -l /usr/local/ssl/lib
 total 1610
 -rw-r--r--   1 watanabe ruby      1386494 Dec  6  2000 libcrypto.a
 -rw-r--r--   1 watanabe ruby       252990 Dec  6  2000 libssl.a
</pre>
<p>
あ、shared library作ってないな。あとで作っとこう。
それはそれとして、こういうときはconfig.logを見て原因を探る。
</p>
<pre>
configure:4019: gcc -o conftest -Os  -L/usr/local/ssl/lib \
    -rpath /usr/local/ssl/lib  conftest.c  1&gt;&amp;5
gcc: unrecognized option `-rpath'
/usr/local/ssl/lib: file not recognized: Is a directory
</pre>
<p>
あきらかに-rpathがまずい。なんでこんなオプション使っているのかな？
-rpathはldのオプションだから、gccから指定するならこうだ。
</p>
<pre>
-Wl,-rpath
</pre>
<p>
とりあえずLinuxの場合だけこうしてみた。
</p>
<pre>
--- configure.in.orig	Tue May 29 07:02:47 2001
+++ configure.in	Thu Jun 14 22:50:55 2001
@@ -207,3 +207,4 @@
   sol2 ) dash_r=&quot;-R&quot; ;;
-  decosf* | linux* | irix*) dash_r=&quot;-rpath &quot; ;;
+  decosf* | irix*) dash_r=&quot;-rpath &quot; ;;
+  linux*) dash_r=&quot;-Wl,-rpath &quot; ;;
   *)
</pre>
<p>
これでautoconfして、もう一度configureし直し。
</p>
<pre>
% ./configure --with-ssl=/usr/local/ssl
&lt;前略&gt;
Looking for SSL libraries in /usr/local/ssl
checking for RSA_new in -lcrypto... yes
checking for SSL_new in -lssl... yes
checking whether SSL libs are resolved at runtime... yes
&lt;後略&gt;
</pre>
<p>
いいみたい。
</p>

<!-- section end -->
</div>

<div class="entry0">
<h3><a name="200106142" title="200106142" href="200106b.html#200106142">■</a> 
OpenSSL 0.9.6</h3>
<p>
Quick Startの通りに実行するとshared libraryを作ってくれないので、
INSTALLをちゃんと読む。すぐにsharedを引数に指定すればいいとわかる。
</p>
<pre>
% ./config shared
% make
% make test
% sudo make install
</pre>
<p>
-rpathまでするアプリケーションは少ないから/etc/ld.so.confに登録。
</p>
<pre>
% sudo vi /etc/ld.so.conf
% sudo ldconfig
</pre>


<!-- section end -->
</div>
<!-- 2001/06/14 end -->



<hr class="hide">
<!-- 2001/06/15 start -->
<h2><a name="20010615" href="200106b.html#20010615">2001-06-15 (Fri)</a></h2>

<div class="entry1">
<h3><a name="200106151" title="200106151" href="200106b.html#200106151">■</a> 
wget 1.7.0</h3>
<p>
できたはいいが、どうもよくわからない。
</p>
<pre>
% wget --proxy=off -s \
  --http-user=username --http-passwd=password \
  https://iw.nifty.com/iw/nifty/iwforum/index.html
--21:34:16--  https://iw.nifty.com/iw/nifty/iwforum/index.html
           =&gt; `index.html'
Connecting to iw.nifty.com:443... connected!

Unable to establish SSL connection.

Unable to establish SSL connection.
</pre>
<p>
となってしまう。-dを追加しても
</p>
<pre>
DEBUG output created by Wget 1.7 on linux-gnu.

parseurl (&quot;https://iw.nifty.com/iw/nifty/iwforum/index.html&quot;) -&gt; \
host iw.nifty.com -&gt; opath iw/nifty/iwforum/index.html -&gt; \
dir iw/nifty/iwforum -&gt; file index.html -&gt; ndir iw/nifty/iwforum
newpath: /iw/nifty/iwforum/index.html
</pre>
<p>
が増えるだけであまり役に立つ情報でもない。うーむ。
</p>


<!-- section end -->
</div>
<!-- 2001/06/15 end -->



<hr class="hide">
<!-- 2001/06/16 start -->
<h2><a name="20010616" href="200106b.html#20010616">2001-06-16 (Sat)</a></h2>

<div class="entry1">
<h3><a name="200106161" title="200106161" href="200106b.html#200106161">■</a> 
<a href="http://www.erikyyy.de/compilercache/">Compilercache</a></h3>

<h4><a name="200106161S1" href="200106b.html#200106161S1">_</a> <strong>なにこれ？</strong>: </h4>
<div class="sub">
<p>
コンパイルした結果をcacheしてくれるというソフトなんだけど、
一体何の役に立つかというと
</p>

</p><ol>
<li>configureしなおしたりした時とか<br><br>

<li>一時的にオプションを変えてmakeして戻すときとか<br><br>

</ol><p>
<p>
こんな場合に素早くmakeが終わる。
特に遅いマシンを使ってるおいらにはうってつけだ。
ディスクも比較的いっぱい余ってるし。
</p>

</div>
<h4><a name="200106161S2" href="200106b.html#200106161S2">_</a> <strong>試す</strong>: </h4>
<div class="sub">
<p>
タイムスタンプを見てるわけではないので、
touchだけだとcacheから取ってくる。
</p>
<pre>
% echo 'main(){}' &gt;main.c
% gcc -c main.c
(compiling into cache)
% touch main.c
% gcc -c main.c
(getting result from cache)
</pre>
<p>
必ずメッセージが出るあたりが気に入らないが、
そのあたりはshell scriptなので何とでもなる。
</p>

</div>
<h4><a name="200106161S3" href="200106b.html#200106161S3">_</a> <strong>md5sum</strong>: </h4>
<div class="sub">
<p>
タイムスタンプじゃないとすると、
一体何を基準にコンパイルするしないを判断しているのか？
bin/compilercacheを見ると、
gcc -Eの結果とgcc -vの結果と一部のコマンドライン引数をファイルにして、
md5sumを取っている。
</p>
<pre>
main
(
)
{
}
Reading specs from /usr/local/lib/gcc-lib/i586-pc-linux-gnu/2.95.3/specs
gcc version 2.95.3 20010315 (release)
IDENTARGS=
COMP=gcc
INPUTNAME=main.c
</pre>
<p>
で、hash値をファイル名にしてmain.oの内容をcacheするわけだ。
あとはcacheディレクトリに同じhash値のものがあればそれをコピーする。
いやあ、面白いなあ。<br>
オプションをつければIDENTARGSが変化するのでhash値も変わる。
COMPも残してるからちょっとした変更でクロスコンパイラにも対応可能だ。
</p>


</div>
<!-- section end -->
</div>
<!-- 2001/06/16 end -->



<hr class="hide">
<!-- 2001/06/17 start -->
<h2><a name="20010617" href="200106b.html#20010617">2001-06-17 (Sun)</a></h2>

<div class="entry1">
<h3><a name="200106171" title="200106171" href="200106b.html#200106171">■</a> 
<a href="http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/16552">Mail/news gateway</a></h3>
<p>
結局鈴木さんと連絡が取れなくて、Daveさんが作ってしまったらしい。
なんかやたらとテストメールが目立ったがそういうことだったか。
</p>

<!-- section end -->
</div>

<div class="entry0">
<h3><a name="200106172" title="200106172" href="200106b.html#200106172">■</a> 
[Cygwin] tar.bz2</h3>
<p>

<a href="#200106122">先日</a> 書いたが、すでにtar.bz2になってるのもあるね。
rsync,fileutils,textutilsはもうtar.bz2だ。
それにしてもCygwinってもう何でもあるなあ。
fileutilsのcpはinstallと同じように
</p>
<pre>
% cp foo /bin
</pre>
<p>
でfoo.exeがあればコピーされるようになったようだ。
</p>

<!-- section end -->
</div>

<div class="entry1">
<h3><a name="200106173" title="200106173" href="200106b.html#200106173">■</a> 
<a href="http://www.erikyyy.de/compilercache/">Compilercache</a></h3>
<p>
PATHとかdebug messageのyes/noは~/.compilercachercで設定する。
今はこんな感じにしてる。
</p>
<pre>
COMPILERCACHEBINDIR=$HOME/compilercache-1.0.9/bin
PATH=/usr/local/bin:/usr/local/cygwin/bin:/usr/bin:/bin
COMPILERPATH=$PATH
SHALLDEBUG=no
</pre>
<p>
~/.zshrcでPATHに
HOME/compilercache-1.0.9/binも加えてある。
でもこのままだとgcc,cc,g++,c++以外はエラーになってしまうので、
もうちょっと
<a href="../files/compilercache.diff">ゆるく</a> してみた。
あとはgccと同じようにbinにsymlinkを張っとけばok。
</p>


<!-- section end -->
</div>
<!-- 2001/06/17 end -->



<hr class="hide">
<!-- 2001/06/18 start -->
<h2><a name="20010618" href="200106b.html#20010618">2001-06-18 (Mon)</a></h2>

<div class="entry1">
<h3><a name="200106181" title="200106181" href="200106b.html#200106181">■</a> 
[Cygwin] gcc-2.95.3-5</h3>
<p>
巷ではGCC 3.0がどーのこーのと騒がれているが、
(てゆうかもう出たの？)Cygwinのほうではgcc-2.95.3-5が出た。
例によってtar.bz2だ。もう完璧に切り替えてきたね。
</p>

<!-- section end -->
</div>

<div class="entry0">
<h3><a name="200106182" title="200106182" href="200106b.html#200106182">■</a> 
[Cygwin] setup.ini</h3>
<p>
setup 2.57になってからsetup.iniも一緒にダウンロードしとかないと、
パッケージを選ぶときに困る。バグか？
</p>


<!-- section end -->
</div>
<!-- 2001/06/18 end -->



<hr class="hide">
<!-- 2001/06/19 start -->
<h2><a name="20010619" href="200106b.html#20010619">2001-06-19 (Tue)</a></h2>

<div class="entry1">
<h3><a name="200106191" title="200106191" href="200106b.html#200106191">■</a> 
<a href="http://gcc.gnu.org/gcc-3.0/gcc-3.0.html">GCC 3.0</a></h3>
<p>
ちゃんと出てるじゃん。<br>
適当に見繕ってconfigure。
</p>
<pre>
% CFLAGS=-Os CXXFLAGS=-Os ../configure --enable-languages=c,c++ \
  --enable-shared --with-system-zlib --enable-sjlj-exceptions \
  --enable-version-specific-runtime-libs --enable-c-mbchar \
  --enable-threads
</pre>

<!-- section end -->
</div>

<div class="entry0">
<h3><a name="200106192" title="200106192" href="200106b.html#200106192">■</a> 
rubyのgc.c</h3>
<p>
GCC 3.0にしたらgc.cの__asm__のとこがwarningになったので修正。
</p>
<pre>
% cat foo.c
char *s = &quot;foo
bar&quot;;
% gcc -V 2.95.3 -c foo.c
% gcc -V 3.0 -c foo.c          
foo.c:1:11: warning: multi-line string literals are deprecated
</pre>
<p>
とgcc 2.95.3だとwarningにならない。
</p>


<!-- section end -->
</div>
<!-- 2001/06/19 end -->



<hr class="hide">
<!-- 2001/06/20 start -->
<h2><a name="20010620" href="200106b.html#20010620">2001-06-20 (Wed)</a></h2>

<div class="entry1">
<h3><a name="200106201" title="200106201" href="200106b.html#200106201">■</a> 
<a href="http://www.erikyyy.de/compilercache/">Compilercache</a></h3>
<p>
真っ先にdebug messageを止めたのには実は理由がある。
configure時に困るのだ。
autoconfはC preprocessorのチェック時に、
標準エラー出力に何か出力されるとエラーとみなす。
最終的に全部失敗するとしかたなくCPP=/lib/cppとして先に進む。
nativeならこれでもほとんど問題ないがcrossのときはまずい。
余計なmessageを出されると困るわけだ。
</p>

<p>
そういった意味では
</p>
<pre>
SHALLDEBUG=&quot;yes&quot;
</pre>
<p>
ではなくて
</p>
<pre>
: ${SHALLDEBUG:=&quot;no&quot;}
</pre>
<p>
となっていたほうがいいかも。これなら確認したいときは
</p>
<pre>
% SHALLDEBUG=yes gcc -c foo.c
</pre>
<p>
とすればいいんだから。
</p>

<!-- section end -->
</div>

<div class="entry0">
<h3><a name="200106202" title="200106202" href="200106b.html#200106202">■</a> 
[Cygwin] WSAEINPROGRESS</h3>
<p>
原因不明のCygwin版のsocketに関するエラーは

<a href="http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/16632">こういうこと</a> らしい。
Windows 2000だからというより、
Windows 2000が動いているようなマシンはそれなりに速いというのが真相だな。
うちじゃ起きないわけだよ。
</p>


<!-- section end -->
</div>
<!-- 2001/06/20 end -->

<hr>
<div>
<a href="200106a.html">&lt;Prev(,)</a> | 
<a href="200106c.html">Next(.)&gt;</a> | 
<a href="index.html">Recent(/)&gt;&gt;</a>
| <a href="index.rdf">RDF</a>
</div>

<hr>
<!-- SiteSearch Google -->
<form method=GET action="https://www.google.co.jp/search">
<p>
<input type=text name=q size=31 maxlength=255 value="">
<input type=hidden name=hl value="ja">
<input type=hidden name=ie value="UTF-8">
<input type=submit name=btnG value="Google 検索">
<input type=hidden name=domains value="jarp.does.notwork.org"><br>
<input type=radio name=sitesearch value=""> WWW を検索
<input type=radio name=sitesearch value="jarp.does.notwork.org" checked> jarp.does.notwork.org を検索 <br>
</form>

<!-- nsmm v0.6.3.2(2005/08/18) -->

<address><a href="&#109;&#x61;&#x69;&#108;&#116;&#111;&#x3A;&#101;&#98;&#x61;&#110;&#64;&#x6F;&#x73;&#x2E;&#x72;&#105;&#109;&#46;&#x6F;&#x72;&#x2E;&#106;&#x70;">わたなべひろふみ</a><br>
Key fingerprint = C456 1350 085F A320 C6C8  8A36 0F15 9B2E EB12 3885<br>
      <a href="https://validator.w3.org/check?uri=referer"><img
          src="https://www.w3.org/Icons/valid-html401"
          alt="Valid HTML 4.01!" height="16" width="88"></a>

<script type="text/javascript" src="http://trackfeed.com/usr/aa7471e560.js"></script>
</address>

<script src="https://www.google-analytics.com/urchin.js" type="text/javascript">
</script>
<script type="text/javascript">
<!--
_uacct = "UA-101613-1";
urchinTracker();
// -->
</script>
<script src="title.js" type="text/javascript">
</script>
</body>
</html>
