<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang="ja-JP">
<head>
<title>Just another Ruby porter, 2014-1-c</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="generator" content="nsmm v0.6.3.2(2005/08/18)">
<meta name="author" content="わたなべひろふみ">
<meta http-equiv="Content-Style-Type" content="text/css">
<META http-equiv="Content-Script-Type" content="text/javascript">
<link rel="stylesheet" href="../css/basic.css" type="text/css" media="all">
<link rel="shortcut icon" type="image/x-icon" href="../favicon.ico">
<link rel="icon" type="image/png" href="../favicon.png">
<link rel="alternate" type="application/rss+xml" title="RSS" href="https://jarp.does.notwork.org/jarp/diary/index.rdf">
<link rev="made" href="&#109;&#x61;&#x69;&#108;&#116;&#111;&#x3A;&#101;&#98;&#x61;&#110;&#64;&#x6F;&#x73;&#x2E;&#x72;&#105;&#109;&#46;&#x6F;&#x72;&#x2E;&#106;&#x70;">
<link rel="index" href="./">
<link rel="prev" href="201401b.html">
<link rel="next" href="201402a.html">

<link rel="stylesheet" type="text/css" href="https://google-code-prettify.googlecode.com/svn/trunk/src/prettify.css">
<script type="text/javascript" src="https://google-code-prettify.googlecode.com/svn/trunk/src/prettify.js"></script>
<script type="text/javascript">
<!--       
$(document).ready(function() {
  prettyPrint();
});
-->
</script>
</head>
<body>
<div><h1><span>Just another Ruby porter,</span></h1></div>

<p>〜2014年1月下旬〜</p>
<hr>
<div>
<a href="201401b.html" accesskey=",">&lt;Prev(,)</a> | 
<a href="201402a.html" accesskey=".">Next(.)&gt;</a> | 
<a href="index.html" accesskey="/">Recent(/)&gt;&gt;</a>
| <a href="index.rdf">RDF</a>
</div>

<hr>

<!-- 2014/01/21 start -->
<h2><a name="20140121" href="201401c.html#20140121">2014-01-21 (Tue)</a></h2>

<div class="entry1">
<h3><a name="201401211" title="201401211" href="201401c.html#201401211">■</a> 
日付は現在じゃなくてHTMLから</h3>
<p>
またダブる件が発生したので
<a href="201312c.html#201312301">HTMLから取ってくる</a>ようにしてみた。<br>
Regexを間に挟んでそこでdayというelementを作りtd.0を入れて&quot;日&quot;を消す。<br>
これで後段のRegexで${day}で参照できる。
</p>
<!-- section end -->
</div>
<!-- 2014/01/21 end -->



<hr class="hide">
<!-- 2014/01/22 start -->
<h2><a name="20140122" href="201401c.html#20140122">2014-01-22 (Wed)</a></h2>

<div class="entry1">
<h3><a name="201401221" title="201401221" href="201401c.html#201401221">■</a> 
svnでrepositoryの位置を変える</h3>
<p>
最近はsvn switchじゃなくてsvn relocateらしい。
</p>
<pre>
% <span style="color:blue;">cd /tmp</span>
% <span style="color:blue;">svn co http://svn.ruby-lang.org/repos/ruby/trunk/cygwin</span>
A    cygwin/GNUmakefile.in
リビジョン 44681 をチェックアウトしました。
% <span style="color:blue;">cd cygwin</span>
% <span style="color:blue;">svn info | grep URL:</span>
URL: http://svn.ruby-lang.org/repos/ruby/trunk/cygwin
% <span style="color:blue;">svn relocate svn+ssh://svn@svn.ruby-lang.org/ruby/trunk/cygwin</span>
% <span style="color:blue;">svn info | grep URL:</span>
URL: svn+ssh://svn@svn.ruby-lang.org/ruby/trunk/cygwin
</pre>
<p>
元がなにかは気にする必要はなく、新repositoryを指定すればいい。
</p>
<!-- section end -->
</div>
<!-- 2014/01/22 end -->



<hr class="hide">
<!-- 2014/01/23 start -->
<h2><a name="20140123" href="201401c.html#20140123">2014-01-23 (Thu)</a></h2>

<div class="entry1">
<h3><a name="201401231" title="201401231" href="201401c.html#201401231">■</a> 
<a href="http://golf.shinh.org/p.rb?Fill+Alternating+Layers">Fill Alternating Layers</a></h3>
<p>
これって対応するカッコとか考える必要はなく空白以外が出てきたら切り替えればいい。
</p>
<pre>
#!ruby -p
gsub(/\S *\S/){$&amp;.tr' ','*'}
</pre>
<p>
ここで2個目の\Sは.で代用可能。
</p>
<!-- section end -->
</div>
<!-- 2014/01/23 end -->



<hr class="hide">
<!-- 2014/01/24 start -->
<h2><a name="20140124" href="201401c.html#20140124">2014-01-24 (Fri)</a></h2>

<div class="entry1">
<h3><a name="201401241" title="201401241" href="201401c.html#201401241">■</a> 
PS3の電源を切る</h3>
<p>
今まではPS3の電源を切るときは律儀にtorneを終了させていたが、<br>
これって一旦XMBに戻ってくるのを待たないといけない。<br>
結構時間がかかる。<br>
3年も経って気づくのも遅いが、torneを終了させるときのXMBで電源を切ればよかったんだな。<br>
消去のときに電源切るなというメッセージの意味を初めて理解した。<br>
コンセントから抜くなと思っていた。
</p>
<!-- section end -->
</div>
<!-- 2014/01/24 end -->



<hr class="hide">
<!-- 2014/01/25 start -->
<h2><a name="20140125" href="201401c.html#20140125">2014-01-25 (Sat)</a></h2>

<div class="entry1">
<h3><a name="201401251" title="201401251" href="201401c.html#201401251">■</a> 
awkの引数で変数代入はいつ行なわれるのか</h3>
<p>
引数のファイルの前での代入ならファイルを読む前に変数を設定できるが、<br>
これって実はBEGINの後なのでBEGINでその変数を使いたいときに困る。<br>
そういう場合は-vオプションを使う。
</p>
<pre>
% <span style="color:blue;">awk 'BEGIN{print foo}' foo=1</span>

% <span style="color:blue;">awk -v foo=1 'BEGIN{print foo}'</span>
1
</pre>
<p>
-vはBEGINより前というかプログラムより前という意味になる。<br>
-vはオプションなので位置に注意。<br>
まあ、この順番で書かないとエラーになるのでわかりやすいともいえる。
</p>
<!-- section end -->
</div>
<!-- 2014/01/25 end -->



<hr class="hide">
<!-- 2014/01/26 start -->
<h2><a name="20140126" href="201401c.html#20140126">2014-01-26 (Sun)</a></h2>

<div class="entry1">
<h3><a name="201401261" title="201401261" href="201401c.html#201401261">■</a> 
sedで[,|,]を置き換える</h3>
<p>
sedで[,|,]を\でquoteとしようとして悩んだ。最初は
</p>
<pre>
% <span style="color:blue;">echo '[|]' | sed 's/[\[\|\]]/\\&/g'</span>
[\|]
</pre>
<p>
としてみたが、なぜか|だけがマッチするようで。<br>
info sedしてみたら、なんとchar classでは\はquoteの意味を持たないとある。
</p>
<pre>
`[LIST]'
`[^LIST]'
     Matches any single character in LIST: for example, `[aeiou]'
     matches all vowels.  A list may include sequences like
     `CHAR1-CHAR2', which matches any character between (inclusive)
     CHAR1 and CHAR2.

     A leading `^' reverses the meaning of LIST, so that it matches any
     single character _not_ in LIST.  To include `]' in the list, make
     it the first character (after the `^' if needed), to include `-'
     in the list, make it the first or last; to include `^' put it
     after the first character.

     The characters `$', `*', `.', `[', and `\' are normally not
     special within LIST.  For example, `[\*]' matches either `\' or
     `*', because the `\' is not special here.  However, strings like
     `[.ch.]', `[=a=]', and `[:space:]' are special within LIST and
     represent collating symbols, equivalence classes, and character
     classes, respectively, and `[' is therefore special within LIST
     when it is followed by `.', `=', or `:'.  Also, when not in
     `POSIXLY_CORRECT' mode, special escapes like `\n' and `\t' are
     recognized within LIST.  *Note Escapes::.
</pre>
<p>
知らなかった。]を指定するには最初に置くしかない。[も意味を持たない。<br>
ということはこうだな。
</p>
<pre>
% <span style="color:blue;">echo '[|]' | sed 's/[]|[]/\\&/g'</span>
\[\|\]
</pre>
<!-- section end -->
</div>
<!-- 2014/01/26 end -->



<hr class="hide">
<!-- 2014/01/27 start -->
<h2><a name="20140127" href="201401c.html#20140127">2014-01-27 (Mon)</a></h2>

<div class="entry1">
<h3><a name="201401271" title="201401271" href="201401c.html#201401271">■</a> 
awkで[,|,]を置き換える</h3>
<p>
気になったのでawkでもやってみた。結構いろんなのがある。<br>
gawk, mawk, busybox awk, bwkで:
</p>
<pre>
% <span style="color:blue;">(setopt SH_WORD_SPLIT;
  for awk in gawk mawk busybox\ awk bwk; do
    printf &quot;%12s: &quot; &quot;$awk&quot;;
    echo '[|] [|]' | $awk 'gsub(/[]|[]/,&quot;\\\\&amp;&quot;, $1)gsub(/[\[\|\]]/,&quot;\\\\&amp;&quot;, $2)';
  done)
</span>
        gawk: \[\|\] \[\|\]
        mawk: \[\|\] \[\|\]
 busybox awk: \[\|\] [\|]
         bwk: \[\|\] \[\|\]
</pre>
<p>
sedと同じ形式である/[]|[]/は全部okだが、<br>
\でquoteする形式である/[\[\|\]]/はbusyboxのawkでは使えないようだ。
</p>
<!-- section end -->
</div>
<!-- 2014/01/27 end -->



<hr class="hide">
<!-- 2014/01/28 start -->
<h2><a name="20140128" href="201401c.html#20140128">2014-01-28 (Tue)</a></h2>

<div class="entry1">
<h3><a name="201401281" title="201401281" href="201401c.html#201401281">■</a> 
IFTTTが止まった</h3>
<p>
というわけで、rubyciとかアメダスのbotとかが止まってる。<br>
アナウンスがないのでどういう状況なのかよくわからんねえ。<br>
ああ、そうか。この日記もIFTTTで通知してたんだった。<br>
さて、復帰したら拾ってくれるんだろうか。
</p>
<!-- section end -->
</div>
<!-- 2014/01/28 end -->



<hr class="hide">
<!-- 2014/01/29 start -->
<h2><a name="20140129" href="201401c.html#20140129">2014-01-29 (Wed)</a></h2>

<div class="entry1">
<h3><a name="201401291" title="201401291" href="201401c.html#201401291">■</a> 
大文字のタグ</h3>
<p>
HTMLのタグって小文字が多いけど、もちろん大文字で書いてもいい。<br>
そのことをすっかり忘れて小文字限定でtitleタグを抜き出す処理を書いたはいいが、<br>
これが失敗するのに2ヶ月ほどかかった。<br>
まあ、それほどまでに大文字で書かれたHTMLタグって稀なんだな。
</p>
<pre>
title=$(curl -sL &quot;$1&quot; | awk -F'&lt;title[^&gt;]*&gt;[\n \t]*|[\n \t]*&lt;/title&gt;' '$0=$2' RS= | nkf --numchar-input)
</pre>
<p>
ってな処理にしたもんだからtolower()が使えず、gawk限定のIGNORECASE=1することでごまかした。<br>
ついでにgawkならということで\sで。
</p>
<pre>
title=$(curl -sL &quot;$1&quot; | gawk -F'&lt;title[^&gt;]*&gt;\\s*|\\s*&lt;/title&gt;' '$0=$2' IGNORECASE=1 RS= | nkf --numchar-input)
</pre>
<p>
ちょっと面倒だが、文字列から正規表現に変換するときにquoteが必要になるので、\\sとしないといけない。
</p>
<!-- section end -->
</div>
<!-- 2014/01/29 end -->



<hr class="hide">
<!-- 2014/01/30 start -->
<h2><a name="20140130" href="201401c.html#20140130">2014-01-30 (Thu)</a></h2>

<div class="entry1">
<h3><a name="201401301" title="201401301" href="201401c.html#201401301">■</a> 
オフラインGmailでも重くなる</h3>
<p>
redmineからなんかいっぱい来てたので、<br>
わざわざオフラインGmailに切り替えてからアーカイブしたんだけど、<br>
裏でいっぱい処理してるらしく結局オフラインでも重くなるのであった。<br>
</p>
<p>
なんか最近Gmailの調子悪いからオンラインでエラー多発してるんだよね。
</p>
<!-- section end -->
</div>
<!-- 2014/01/30 end -->



<hr class="hide">
<!-- 2014/01/31 start -->
<h2><a name="20140131" href="201401c.html#20140131">2014-01-31 (Fri)</a></h2>

<div class="entry1">
<h3><a name="201401311" title="201401311" href="201401c.html#201401311">■</a> 
IFTTTのEntryImageUrl</h3>
<p>
これってRSSのどこに相当するのかよくわからんのでぐぐってみたら、<br>
<a href="https://ifttt.com/channels/feed/triggers/5-new-feed-item">IFTTT / New feed item trigger on the Feed channel</a>にヒット。
</p>
<pre>
URL for the first image in the entry. If the entry doesn't have an image will point to a placeholder image.
</pre>
<p>
と言われてもよくわからないが、<br>
<a href="https://twitter.com/bartjeb/status/232118200161169410">https://twitter.com/bartjeb/status/232118200161169410</a>によると<br>
contentとかdescriptionの中にimgタグを埋め込んでおけという意味のようで。<br>
だったらYahoo Pipesでもなんとかなりそうなので、アメダスbotでやってみよう。
</p>
<!-- section end -->
</div>
<!-- 2014/01/31 end -->

<hr>
<div>
<a href="201401b.html">&lt;Prev(,)</a> | 
<a href="201402a.html">Next(.)&gt;</a> | 
<a href="index.html">Recent(/)&gt;&gt;</a>
| <a href="index.rdf">RDF</a>
</div>

<hr>
<!-- SiteSearch Google -->
<form method=GET action="https://www.google.co.jp/search">
<p>
<input type=text name=q size=31 maxlength=255 value="">
<input type=hidden name=hl value="ja">
<input type=hidden name=ie value="UTF-8">
<input type=submit name=btnG value="Google 検索">
<input type=hidden name=domains value="jarp.does.notwork.org"><br>
<input type=radio name=sitesearch value=""> WWW を検索
<input type=radio name=sitesearch value="jarp.does.notwork.org" checked> jarp.does.notwork.org を検索 <br>
</form>

<!-- nsmm v0.6.3.2(2005/08/18) -->

<address><a href="&#109;&#x61;&#x69;&#108;&#116;&#111;&#x3A;&#101;&#98;&#x61;&#110;&#64;&#x6F;&#x73;&#x2E;&#x72;&#105;&#109;&#46;&#x6F;&#x72;&#x2E;&#106;&#x70;">わたなべひろふみ</a><br>
Key fingerprint = C456 1350 085F A320 C6C8  8A36 0F15 9B2E EB12 3885<br>
      <a href="http://validator.w3.org/check?uri=referer"><img
          src="http://www.w3.org/Icons/valid-html401"
          alt="Valid HTML 4.01!" height="16" width="88"></a>

<script type="text/javascript" src="http://trackfeed.com/usr/aa7471e560.js"></script>
</address>

<script src="https://www.google-analytics.com/urchin.js" type="text/javascript">
</script>
<script type="text/javascript">
<!--
_uacct = "UA-101613-1";
urchinTracker();
// -->
</script>
<script src="title.js" type="text/javascript">
</script>
</body>
</html>
