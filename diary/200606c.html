<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang="ja-JP">
<head>
<title>Just another Ruby porter, 2006-6-c</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="generator" content="nsmm v0.6.3.2(2005/08/18)">
<meta name="author" content="わたなべひろふみ">
<meta http-equiv="Content-Style-Type" content="text/css">
<META http-equiv="Content-Script-Type" content="text/javascript">
<link rel="stylesheet" href="../css/basic.css" type="text/css" media="all">
<link rel="shortcut icon" type="image/x-icon" href="../favicon.ico">
<link rel="icon" type="image/png" href="../favicon.png">
<link rel="alternate" type="application/rss+xml" title="RSS" href="https://eban.github.io/jarp/diary/index.rdf">
<link rev="made" href="&#109;&#x61;&#x69;&#108;&#116;&#111;&#x3A;&#101;&#98;&#x61;&#110;&#64;&#x6F;&#x73;&#x2E;&#x72;&#105;&#109;&#46;&#x6F;&#x72;&#x2E;&#106;&#x70;">
<link rel="index" href="./">
<link rel="prev" href="200606b.html">
<link rel="next" href="200607a.html">

</head>
<body>
<div><h1><span>Just another Ruby porter,</span></h1></div>

<p>〜2006年6月下旬〜</p>
<hr>
<div>
<a href="200606b.html" accesskey=",">&lt;Prev(,)</a> | 
<a href="200607a.html" accesskey=".">Next(.)&gt;</a> | 
<a href="index.html" accesskey="/">Recent(/)&gt;&gt;</a>
| <a href="index.rdf">RDF</a>
</div>

<hr>

<!-- 2006/06/21 start -->
<h2><a name="20060621" href="200606c.html#20060621">2006-06-21 (Wed)</a></h2>
<!-- 2006-06-22 01:17:34 -->

<div class="entry1">
<h3><a name="200606211" title="200606211" href="200606c.html#200606211">■</a> 
<a href="http://ascii-wm.net/">[WC] ASCII-WM 2006</a></h3>
<p>
なぜか終わってから思い出す。今日も見れず。
</p>

<!-- section end -->
</div>

<div class="entry0">
<h3><a name="200606212" title="200606212" href="200606c.html#200606212">■</a> 
[Gmail] Gmail不調</h3>
<p>
なんか初めてみるメッセージ。
</p><blockquote><dl>
<dt>
Server Error
<dd>
Gmail is temporarily unavailable.
Cross your fingers and try again in a few minutes.
We're sorry for the inconvenience.
</dl></blockquote><p>
全部Gmailに送ってるだけにちょっと困る。
</p>
<!-- section end -->
</div>
<!-- 2006/06/21 end -->



<hr class="hide">
<!-- 2006/06/22 start -->
<h2><a name="20060622" href="200606c.html#20060622">2006-06-22 (Thu)</a></h2>
<!-- 2006-06-23 04:01:41 -->

<div class="entry1">
<h3><a name="200606221" title="200606221" href="200606c.html#200606221">■</a> 
早寝</h3>
<p>
早朝にそなえて起きてるか寝るかどっちにしよう迷ったが、早く寝ることにした。おやすみ。
</p>
<!-- section end -->
</div>
<!-- 2006/06/22 end -->



<hr class="hide">
<!-- 2006/06/23 start -->
<h2><a name="20060623" href="200606c.html#20060623">2006-06-23 (Fri)</a></h2>
<!-- 2006-06-24 16:50:30 -->

<div class="entry1">
<h3><a name="200606231" title="200606231" href="200606c.html#200606231">■</a> 
[FC5] カウントダウン</h3>
<p>
最近Subject: The certificate for xxxxxxxx will expire in 24 days
というメールがrootから来てるんだけど、あと24日以内になんとかしないといけないらしい。
</p>
<pre>
 ################# SSL Certificate Warning ################

  Certificate for hostname 'xxxxxxxx', in file:
     /etc/pki/tls/certs/localhost.crt

  The certificate needs to be renewed; this can be done
  using the 'genkey' program.

  Browsers will not be able to correctly connect to this
  web site using SSL until the certificate is renewed.

 ##########################################################
                                  Generated by certwatch(1)
</pre>
<p>
http serverなんて立ち上げてないし、なんか面倒だな。
放っといてみる。
</p>
<!-- section end -->
</div>
<!-- 2006/06/23 end -->



<hr class="hide">
<!-- 2006/06/24 start -->
<h2><a name="20060624" href="200606c.html#20060624">2006-06-24 (Sat)</a></h2>
<!-- 2006-06-25 01:29:14 -->

<div class="entry1">
<h3><a name="200606241" title="200606241" href="200606c.html#200606241">■</a> 
[Mail] Your account access has been limited !</h3>
<p>
PayPalからきたメールがなんともあやしい。
ヘッダを確認してみるとpaypal.comからじゃないし、
HTMLメールになっているのもおかしい。
</p>
<pre>
Security Center Advisory!

PayPal is constantly working to ensure security by regularly screening
the accounts in our system. We recently reviewed your account, and we
need more information to help us provide you with secure
service. Until we can collect this information, your access to
sensitive account features will be limited or terminated. We would
like to restore your access as soon as possible, and we apologize for
the inconvenience.

Why is my account access limited?

Your account access has been limited for the following reason(s):

# Jun 24, 2006: We have reason to believe that your account was
accessed by a third party. Because protecting the security of your
account is our primary concern, we have limited access to sensitive
PayPal account features. We understand that this may be an
inconvenience but please understand that this temporary limitation
is for your protection.


Click here to Remove Limitations


Completing all of the checklist items will automatically restore your
account access.

Thank you for using PayPal! The PayPal Team
Please do not reply to this e-mail. Mail sent to this address cannot
be answered. For assistance, log in to your PayPal account and choose
the &quot;Help&quot; link in the footer of any page.

To receive email notifications in plain text instead of HTML, update
your preferences here.
</pre>
<p>
文面に名前がない。Click here to Remove Limitationsのリンクが
</p>
<pre>
http://2080409283/secure/redirect.to/以下省略
</pre>
<p>
といかにもあやしげ。IPアドレスを10進で表現してるあたりもせこいな。
</p>
<pre>
% ruby -e 'p [2080409283].pack(&quot;N&quot;).unpack(&quot;C4&quot;).join(&quot;.&quot;)'
&quot;124.0.134.195&quot;
</pre>

<!-- section end -->
</div>
<!-- 2006/06/24 end -->



<hr class="hide">
<!-- 2006/06/25 start -->
<h2><a name="20060625" href="200606c.html#20060625">2006-06-25 (Sun)</a></h2>
<!-- 2006-06-26 00:31:12 -->

<div class="entry1">
<h3><a name="200606251" title="200606251" href="200606c.html#200606251">■</a> 
[Zsh] /etc/profile.d/kde.sh:4: = not found</h3>
<p>
yum updateしたらzshを立ち上げるたびに文句を言われるようになった。
3日ほど放置してたがいい加減調べることにした。
問題のメッセージは
</p>
<pre>
/etc/profile.d/kde.sh:4: = not found
</pre>
<p>
で、該当する行は
</p>
<pre>
if [ &quot;$PRELINKING&quot; == yes ] ; then
</pre>
<p>
だ。==がまずいね。bashならありだけど。
</p>
<pre>
if [ &quot;$PRELINKING&quot; = yes ] ; then
</pre>
<p>
が正解。
</p>

<!-- section end -->
</div>

<div class="entry0">
<h3><a name="200606252" title="200606252" href="200606c.html#200606252">■</a> 
[Ruby] 100までの整数から素数を列挙せよ</h3>
<p>
OpenSSLだと2が素数にならないのが痛い。
</p>
<pre>
% openssl prime 2
2 is not prime
</pre>
<p>
一応RubyのOpenSSLを使ったバージョン。
</p>
<pre>
% ruby -ropenssl -e 'puts((1..100).select{|i|OpenSSL::BN.new(i.to_s).prime?(0)||i==2}*&quot; &quot;)'       
2 3 5 7 11 13 17 19 23 29 31 37 41 43 47 53 59 61 67 71 73 79 83 89 97
</pre>
<p>
やっぱOpenSSL::BNは整数も受け付けて欲しいな。
</p>

<!-- section end -->
</div>

<div class="entry1">
<h3><a name="200606253" title="200606253" href="200606c.html#200606253">■</a> 
[Ruby] Array#*でjoin</h3>
<p>
あまり知られてないけどArray#*で整数じゃなくて文字列を渡すとjoinになる。
</p>
<pre>
% ruby -e 'p [0,1,2]*&quot; &quot;'
&quot;0 1 2&quot;
</pre>
<p>
Ruby Golfでよく使われる。
</p>
<!-- section end -->
</div>
<!-- 2006/06/25 end -->



<hr class="hide">
<!-- 2006/06/26 start -->
<h2><a name="20060626" href="200606c.html#20060626">2006-06-26 (Mon)</a></h2>
<!-- 2006-06-27 00:56:03 -->

<div class="entry1">
<h3><a name="200606261" title="200606261" href="200606c.html#200606261">■</a> 
[Ruby] headとtail</h3>
<p>
Rubyの場合は富豪的には
</p>
<pre>
print ARGF.to_a.first(10)
print ARGF.to_a.last(10)
</pre>
<p>
でheadとtailができるが、もっと変なのを考えてみた。
</p>
<pre>
print ARGF.read[/(^.*\n){1,10}/]
print ARGF.read[/(^.*\n){1,10}\Z/]
</pre>
<p>
でheadとtail。
</p>

<!-- section end -->
</div>

<div class="entry0">
<h3><a name="200606262" title="200606262" href="200606c.html#200606262">■</a> 
[PC] マウス</h3>
<p>
ELECOMの安い光学式マウスを買った。1500円ぐらい。
今度は
<a href="200504a.html#200504071">無駄に青白く光らない</a>。
ちょっと小さめで小さめのマウスパッドとの相性もいいようだ。
ただ、PS/2に差すとなぜかあっちこっちに飛ぶようで、
USBで使うようにしてる。やっとUSBハブが役に立つときがきた。
</p>
<!-- section end -->
</div>
<!-- 2006/06/26 end -->



<hr class="hide">
<!-- 2006/06/27 start -->
<h2><a name="20060627" href="200606c.html#20060627">2006-06-27 (Tue)</a></h2>
<!-- 2006-06-28 02:08:42 -->

<div class="entry1">
<h3><a name="200606271" title="200606271" href="200606c.html#200606271">■</a> 
[CVS] loginfo_version.rb</h3>
<p>
久し振りに戻したら、やはりまつもとさんのとこではブロックしてしまったらしい。
でも、とりあえずこのままで様子見ということで。
</p>

<p>
現在のversion.h自動更新のloginfoは
</p>
<pre>
ALL $CVSROOT/CVSROOT/loginfo_version.rb %p %s
</pre>
<p>
という感じでloginfo_version.rbはこんな感じ。
</p>
<pre>
#! /usr/bin/ruby

require 'tmpdir'
require 'fileutils'

def workdir
  dir = File.join(Dir.tmpdir, 'tmp-' + Process.pid.to_s + '-' +
    Time.now.to_i.to_s)
  Dir.mkdir dir
  Dir.chdir dir do
    yield dir
  end
  FileUtils.rm_rf dir
end

#def system(*args)
#  print args, &quot;\n&quot;
#  super
#end

mod = ARGV.shift
exit unless %r{^ruby(/|$)} =~ mod
ARGV.each do |x|
  exit if x == 'version.h'
end
mod = mod[/^(.*?)\//] if /\// =~ mod

while line = STDIN.gets
  case line
  when /Tag: (.*)/
    branch = '-r ' + $1
  when /(Modified|Added) Files:/
    doit = true
  end
end

exit unless doit

version_h = File.join(mod, &quot;version.h&quot;)
now = Time.now
today = now.strftime(&quot;%Y-%m-%d&quot;)
formats = {
  'DATE' =&gt; '&quot;%Y-%m-%d&quot;',
  'TIME' =&gt; '&quot;%H:%M:%S&quot;',
  'CODE' =&gt; '%Y%m%d',
  'YEAR' =&gt; '%Y',
  'MONTH' =&gt; '%m',
  'DAY' =&gt; '%d'
}

workdir do |work|
  print &quot;checking out version.h\n&quot;
  system &quot;cvs -Q co #{branch} #{version_h}&quot;
  print &quot;modifing version.h\n&quot;
  all = File.read(version_h)
  ret = all.gsub!(/RUBY_RELEASE_(#{formats.keys.join('|')})(\s+)(.+)/) do
    &quot;RUBY_RELEASE_&quot; + $1 + $2 + now.strftime(formats[$1]).sub(/^0/, '')
  end
  if ret
    open(version_h, &quot;w&quot;) do |fh| fh.print all end
    print &quot;checking in version.h\n&quot;
    system &quot;cvs -Q ci -m #{today} #{version_h}&quot;
  end
end
</pre>

<!-- section end -->
</div>
<!-- 2006/06/27 end -->



<hr class="hide">
<!-- 2006/06/28 start -->
<h2><a name="20060628" href="200606c.html#20060628">2006-06-28 (Wed)</a></h2>
<!-- 2006-06-29 01:07:03 -->

<div class="entry1">
<h3><a name="200606281" title="200606281" href="200606c.html#200606281">■</a> 
止まったエスカレータ</h3>
<p>
大宮駅に着くととてつもない轟音が響き渡っていた。<br>
その音の源を探ると天窓を叩く雨だった。<br>
このままじゃ帰れそうもないので、<br>
駅ビルの本屋で時間を潰そうとエスカレータを3階ほど昇る。<br>
突然停止しあたりも真っ暗に。<br>
停電だ。雷が落ちたか？<br>
そこでどういう行動をとるかというと、とりあえず目的階までは歩いて昇る。<br>
なぜかみんなそんな感じ。<br>
で、この突然止まったエスカレータってのがやたらと歩きづらい。<br>
動いてるときは手摺りに捕まらなくてもまったく問題なく歩けるのに。<br>
たびたび話題になるけど、これってなんでだろうねえ。
</p>
<!-- section end -->
</div>
<!-- 2006/06/28 end -->



<hr class="hide">
<!-- 2006/06/29 start -->
<h2><a name="20060629" href="200606c.html#20060629">2006-06-29 (Thu)</a></h2>
<!-- 2006-06-30 00:22:50 -->

<div class="entry1">
<h3><a name="200606291" title="200606291" href="200606c.html#200606291">■</a> 
<a href="http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-talk/199407">[Ruby] RubyGems 0.9.0 Release</a></h3>
<p>
早速更新。
</p>
<pre>
% gem env
Rubygems Environment:
  - VERSION: 0.8.11 (0.8.11)
  - INSTALLATION DIRECTORY: /usr/local/lib/ruby/gems/1.8
  - GEM PATH:
     - /usr/local/lib/ruby/gems/1.8
  - REMOTE SOURCES:
     - http://gems.rubyforge.org
% gem up --system
Upgrading RubyGems...
Updating Gem source index for: http://gems.rubyforge.org
Attempting remote upgrade of rubygems-update
Attempting remote installation of 'rubygems-update'
Successfully installed rubygems-update-0.9.0
Updating version of RubyGems to 0.9.0
Installing RubyGems 0.9.0
&lt;途中略&gt;
As of RubyGems 0.8.0, library stubs are no longer needed.
Searching $LOAD_PATH for stubs to optionally delete (may take a while)...
...done.
No library stubs found.

  Successfully built RubyGem
  Name: sources
  Version: 0.0.1
  File: sources-0.0.1.gem
RubyGems system software updated
% gem env
Rubygems Environment:
  - VERSION: 0.9.0 (0.9.0)
  - INSTALLATION DIRECTORY: /usr/local/lib/ruby/gems/1.8
  - GEM PATH:
     - /usr/local/lib/ruby/gems/1.8
  - REMOTE SOURCES:
     - http://gems.rubyforge.org
</pre>
<p>
いけてるようだ。railsを上げてみよう。
</p>
<pre>
% gem up -y rails
Updating installed gems...
Attempting remote update of rails
ERROR:	While executing gem ... (Gem::GemNotFoundException)
    Could not find rails (&gt; 0) in the repository
</pre>
<p>
なぜか失敗する。
</p>
<pre>
% hexdump -C $(gem env gempath)/source_cache
00000000  04 08 7b 06 22 1e 68 74  74 70 3a 2f 2f 67 65 6d  |..{.&quot;.http://gem|
00000010  73 2e 72 75 62 79 66 6f  72 67 65 2e 6f 72 67 6f  |s.rubyforge.orgo|
00000020  3a 1e 47 65 6d 3a 3a 53  6f 75 72 63 65 49 6e 66  |:.Gem::SourceInf|
00000030  6f 43 61 63 68 65 45 6e  74 72 79 07 3a 0a 40 73  |oCacheEntry.:.@s|
00000040  69 7a 65 69 03 e4 b9 3a  3a 12 40 73 6f 75 72 63  |izei...::.@sourc|
00000050  65 5f 69 6e 64 65 78 6f  3a 15 47 65 6d 3a 3a 53  |e_indexo:.Gem::S|
00000060  6f 75 72 63 65 49 6e 64  65 78 06 3a 0a 40 67 65  |ourceIndex.:.@ge|
00000070  6d 73 7b 00                                       |ms{.|
00000074
</pre>
<p>
こんなに小さいわけないしなあ。キャッシュがこわれてるようだ。消そう。
</p>
<pre>
% rm $(gem env gempath)/source_cache
% gem up -y rails
Updating installed gems...
Bulk updating Gem source index for: http://gems.rubyforge.org
Attempting remote update of rails
Successfully installed rails-1.1.3
Successfully installed rake-0.7.1
Successfully installed activesupport-1.3.1
Successfully installed activerecord-1.14.3
Successfully installed actionpack-1.12.2
Successfully installed actionmailer-1.2.2
Successfully installed actionwebservice-1.1.3
Installing ri documentation for rake-0.7.1...
Installing ri documentation for activesupport-1.3.1...
Installing ri documentation for activerecord-1.14.3...
Installing ri documentation for actionpack-1.12.2...
Installing ri documentation for actionmailer-1.2.2...
Installing ri documentation for actionwebservice-1.1.3...
Installing RDoc documentation for rake-0.7.1...
Installing RDoc documentation for activesupport-1.3.1...
Installing RDoc documentation for activerecord-1.14.3...
Installing RDoc documentation for actionpack-1.12.2...
Installing RDoc documentation for actionmailer-1.2.2...
Installing RDoc documentation for actionwebservice-1.1.3...
Gems: [rails] updated
</pre>
<p>
いいみたい。
</p>
<!-- section end -->
</div>
<!-- 2006/06/29 end -->



<hr class="hide">
<!-- 2006/06/30 start -->
<h2><a name="20060630" href="200606c.html#20060630">2006-06-30 (Fri)</a></h2>
<!-- 2006-07-01 10:46:07 -->

<div class="entry1">
<h3><a name="200606301" title="200606301" href="200606c.html#200606301">■</a> 
[Ruby] dl/win32.rbをLinuxで使ってみる</h3>
<p>
変なことを思いついた。
dl/win32.rb自体はwin32に依存してるものはなにもない。
単にWin32APIとAPI互換のライブラリを用意したものだけなので。
</p>

<p>
というわけで試してみる。

<a href="http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-dev/28916">unameの話題が出てた</a>
ので、これのLinux版。man 2 unameしてみると
</p>
<pre>
#include &lt;sys/utsname.h&gt;
int uname(struct utsname *buf);
</pre>
<p>
で、/usr/include/{sys,bit}/utsname.hを見ると、なんだかんで
</p>
<pre>
struct utsname {
        char sysname[65];
        char nodename[65];
        char release[65];
        char version[65];
        char machine[65];
};
</pre>
<p>
ということらしい。つまりバッファとしては65*5バイトあればいいわけだ。
</p>
<pre>
require 'dl/win32'

uname = Win32API.new('/lib/libc.so.6', 'uname', 'P', 'I')
ptr = &quot; &quot; * 65 * 5
uname.call(ptr)
p ptr.unpack(&quot;A65&quot; * 5)
</pre>
<p>
というのを実行してみると
</p><blockquote><p>
[&quot;Linux&quot;, &quot;cow.localdomain&quot;, &quot;2.6.16-1.2133_FC5smp&quot;, &quot;#1 SMP Tue Jun 6 01:52:09 EDT 2006&quot;, &quot;i686&quot;]
</p></blockquote><p>
と無事得られた。
</p>

<p>
さて、これをRuby/DLで書くにはどうすればいいのか？
つづく(かもしれない)。
</p>
<!-- section end -->
</div>
<!-- 2006/06/30 end -->

<hr>
<div>
<a href="200606b.html">&lt;Prev(,)</a> | 
<a href="200607a.html">Next(.)&gt;</a> | 
<a href="index.html">Recent(/)&gt;&gt;</a>
| <a href="index.rdf">RDF</a>
</div>

<hr>
<!-- SiteSearch Google -->
<form method=GET action="http://www.google.co.jp/search">
<p>
<input type=text name=q size=31 maxlength=255 value="">
<input type=hidden name=hl value="ja">
<input type=hidden name=ie value="UTF-8">
<input type=submit name=btnG value="Google 検索">
<input type=hidden name=domains value="eban.github.io"><br>
<input type=radio name=sitesearch value=""> WWW を検索
<input type=radio name=sitesearch value="eban.github.io" checked> eban.github.io を検索 <br>
</form>

<!-- nsmm v0.6.3.2(2005/08/18) -->

<address><a href="&#109;&#x61;&#x69;&#108;&#116;&#111;&#x3A;&#101;&#98;&#x61;&#110;&#64;&#x6F;&#x73;&#x2E;&#x72;&#105;&#109;&#46;&#x6F;&#x72;&#x2E;&#106;&#x70;">わたなべひろふみ</a><br>
Key fingerprint = C456 1350 085F A320 C6C8  8A36 0F15 9B2E EB12 3885<br>
      <a href="http://validator.w3.org/check?uri=referer"><img
          src="http://www.w3.org/Icons/valid-html401"
          alt="Valid HTML 4.01!" height="16" width="88"></a>

<script type="text/javascript" src="http://trackfeed.com/usr/aa7471e560.js"></script>
</address>

<script src="http://www.google-analytics.com/urchin.js" type="text/javascript">
</script>
<script type="text/javascript">
<!--
_uacct = "UA-101613-1";
urchinTracker();
// -->
</script>
<script src="title.js" type="text/javascript">
</script>
</body>
</html>
