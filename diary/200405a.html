<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang="ja-JP">
<head>
<title>Just another Ruby porter, 2004-5-a</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="generator" content="nsmm v0.6.3.2(2005/08/18)">
<meta name="author" content="わたなべひろふみ">
<meta http-equiv="Content-Style-Type" content="text/css">
<META http-equiv="Content-Script-Type" content="text/javascript">
<link rel="stylesheet" href="../css/basic.css" type="text/css" media="all">
<link rel="shortcut icon" type="image/x-icon" href="../favicon.ico">
<link rel="icon" type="image/png" href="../favicon.png">
<link rel="alternate" type="application/rss+xml" title="RSS" href="https://jarp.does.notwork.org/jarp/diary/index.rdf">
<link rev="made" href="&#109;&#x61;&#x69;&#108;&#116;&#111;&#x3A;&#101;&#98;&#x61;&#110;&#64;&#x6F;&#x73;&#x2E;&#x72;&#105;&#109;&#46;&#x6F;&#x72;&#x2E;&#106;&#x70;">
<link rel="index" href="./">
<link rel="prev" href="200404c.html">
<link rel="next" href="200405b.html">

</head>
<body>
<div><h1><span>Just another Ruby porter,</span></h1></div>

<p>〜2004年5月上旬〜</p>
<hr>
<div>
<a href="200404c.html" accesskey=",">&lt;Prev(,)</a> | 
<a href="200405b.html" accesskey=".">Next(.)&gt;</a> | 
<a href="index.html" accesskey="/">Recent(/)&gt;&gt;</a>
| <a href="index.rdf">RDF</a>
</div>

<hr>

<!-- 2004/05/01 start -->
<h2><a name="20040501" href="200405a.html#20040501">2004-05-01 (Sat)</a></h2>

<div class="entry1">
<h3><a name="200405011" title="200405011" href="200405a.html#200405011">■</a> 
4月のspam</h3>
<p>
4580通。やはり4月になると毎年spamも増える。
そろそろサーバ側で対処しないとやばいか。
rimは今のところ制限なしだからいいんだけど。
</p>

<!-- section end -->
</div>

<div class="entry0">
<h3><a name="200405012" title="200405012" href="200405a.html#200405012">■</a> 
<a href="http://www.namikilab.tuat.ac.jp/~sasada/diary/200405.html#d1">[名前] libibertyとはなんぞや？</a></h3>
<p>
-libertyと書けば一目瞭然。って、すでにコメントがついてるや。
</p>
<!-- section end -->
</div>
<!-- 2004/05/01 end -->



<hr class="hide">
<!-- 2004/05/02 start -->
<h2><a name="20040502" href="200405a.html#20040502">2004-05-02 (Sun)</a></h2>

<div class="entry1">
<h3><a name="200405021" title="200405021" href="200405a.html#200405021">■</a> 
[PC] COMBOドライブ</h3>
<p>
買って4ヶ月ほど経つPCのCOMBOドライブで、とりあえずバックアップをDVD-Rに焼こうと思い立つ。
1枚95円で買ったメディアが心配ながら、それだけ安けりゃ失敗してもいいやと
<a href="http://www.burn4free.com/">Burn4Free</a>で試したら、何度焼き込もうとしてもメディアを入れろと言われる。
なんか変だなとPCのスペックを確認したら、なんとこのCOMBOドライブのDVDは書き込めないことが判明。
ずっと書けると思っていただけに間抜けだ。というか、買ってすぐに試せって。
</p>

<p>
明日はドライブを探しに行こう。あ、でも、銀行は休みだっけ？
</p>
<!-- section end -->
</div>
<!-- 2004/05/02 end -->



<hr class="hide">
<!-- 2004/05/03 start -->
<h2><a name="20040503" href="200405a.html#20040503">2004-05-03 (Mon)</a></h2>

<div class="entry1">
<h3><a name="200405031" title="200405031" href="200405a.html#200405031">■</a> 
[PC] comboドライブ</h3>
<p>
というわけで、8300円のcomboドライブを買った。しかし、遅い。
もうちょっといいやつを買うべきだったか。
</p>
<!-- section end -->
</div>
<!-- 2004/05/03 end -->



<hr class="hide">
<!-- 2004/05/04 start -->
<h2><a name="20040504" href="200405a.html#20040504">2004-05-04 (Tue)</a></h2>

<div class="entry1">
<h3><a name="200405041" title="200405041" href="200405a.html#200405041">■</a> 
[Movie] 陰陽師2</h3>
<p>
予想通りの映画だった。続きはもうないな。
</p>
<!-- section end -->
</div>
<!-- 2004/05/04 end -->



<hr class="hide">
<!-- 2004/05/05 start -->
<h2><a name="20040505" href="200405a.html#20040505">2004-05-05 (Wed)</a></h2>

<div class="entry1">
<h3><a name="200405051" title="200405051" href="200405a.html#200405051">■</a> 
[Movie] KILL BILL</h3>
<p>
修羅雪姫かと思った。特典を見たらまさにそうだった。
</p>

<!-- section end -->
</div>

<div class="entry0">
<h3><a name="200405052" title="200405052" href="200405a.html#200405052">■</a> 
[TV] 登竜門F</h3>
<p>
嘉陽愛子へのFAXが「ヨーコサイコー!!」はまずいだろう。
それにしても蒼井そらが歌うとday after tomorrowのmisonoと区別がつかない。
「お世話になっております」には笑った。
</p>

<p>
さくらんぼブービーと千鳥とハローバイバイが面白かった。
でも一番笑ったのは村上ショージだったかもしれない。
</p>
<!-- section end -->
</div>
<!-- 2004/05/05 end -->



<hr class="hide">
<!-- 2004/05/06 start -->
<h2><a name="20040506" href="200405a.html#20040506">2004-05-06 (Thu)</a></h2>

<div class="entry1">
<h3><a name="200405061" title="200405061" href="200405a.html#200405061">■</a> 
[PC] Diamondcrysta RDT178V</h3>
<p>
液晶ディスプレイがなんか暗いような気がするので、新しいディスプレイを買ってみた。
なんか勝手に調整されてすごい楽だ。しかもまぶしいぐらいに明るい。
満足。
</p>

<!-- section end -->
</div>

<div class="entry0">
<h3><a name="200405062" title="200405062" href="200405a.html#200405062">■</a> 
[PC] comboドライブ</h3>
<p>
外付けのUSB接続のcomboドライブが9000円で売ってた。そんなに安いのか？
焼くのはたまにだし、外付けで十分だったという気がしてきた。
</p>

<!-- section end -->
</div>

<div class="entry1">
<h3><a name="200405063" title="200405063" href="200405a.html#200405063">■</a> 
<a href="http://jt.mozilla.gr.jp/products/thunderbird/releases/">[MUA] Thunderbird 0.6</a></h3>
<p>
さっそくLinux版をダウンロードして試してみたら、libstdc++.so.5とlibgcc_s.so.1を要求された。
やっぱそうくるか。gcc 3.3.3を作りなおそう。
--disable-sharedをやめれば、libstdc++.so.5は自然にできるので問題ないが、
libgcc_s.so.1は$(prefix)/lib/gcc-lib/&lt;target&gt;/3.3.3/にインストールされるから、
LD_LIBRARY_PATHか何かで指定する必要がある。
thuderbird自体shell scriptだから、ここに入れてしまおう。
これで立ち上がることを確認した。あとはIMAPサーバをなんとかするだけだな。
</p>
<!-- section end -->
</div>
<!-- 2004/05/06 end -->



<hr class="hide">
<!-- 2004/05/07 start -->
<h2><a name="20040507" href="200405a.html#20040507">2004-05-07 (Fri)</a></h2>

<div class="entry1">
<h3><a name="200405071" title="200405071" href="200405a.html#200405071">■</a> 
[GCC] -mcpuと-mtuneオプション</h3>
<p>
GCC 3.4.0からは-mcpuオプションはdeprecateになったらしい。
<a href="http://www.MPlayerHQ.hu/">MPlayer 1.0pre4</a>をmakeしてたら
</p><blockquote class="cite"><p>
`-mcpu=' is deprecated. Use `-mtune=' or '-march=' instead.
</p></blockquote><p>
というメッセージだらけになった。
普通は-marchも同時に指定するから単に削除するだけでよさそう。
<!-- section end -->
</div>
<!-- 2004/05/07 end -->



<hr class="hide">
<!-- 2004/05/08 start -->
<h2><a name="20040508" href="200405a.html#20040508">2004-05-08 (Sat)</a></h2>

<div class="entry1">
<h3><a name="200405081" title="200405081" href="200405a.html#200405081">■</a> 
<a href="http://pcweb.mycom.co.jp/articles/2004/05/08/gmail/">[Mail] 1GBの衝撃! Googleの無料Webメールサービス「Gmail」</a></h3>
<p>
レビュー記事。しかし、どうすればベータテスターになれるんだ？
</p>

<!-- section end -->
</div>

<div class="entry0">
<h3><a name="200405082" title="200405082" href="200405a.html#200405082">■</a> 
[Ruby] lilyをport 10080で動かす</h3>
<p>
lily.cfgで
</p>
<pre>
url                 http://localhost:10080/cgi-bin/lily.cgi
</pre>
<p>
のように書いておけばいいようだ。ってことは、
<a href="200404a.html#200404061">w3mのlocal cgiで動かす</a>には
</p>
<pre>
url                 file:///cgi-bin/lily.cgi
</pre>
<p>
と書くだけでよかったわけだ。
</p>
<!-- section end -->
</div>
<!-- 2004/05/08 end -->



<hr class="hide">
<!-- 2004/05/09 start -->
<h2><a name="20040509" href="200405a.html#20040509">2004-05-09 (Sun)</a></h2>

<div class="entry1">
<h3><a name="200405091" title="200405091" href="200405a.html#200405091">■</a> 
[Ruby] lilyの高速化</h3>
<p>
2001年から日記を書き続けているので、1日1ファイルとしても1000以上のファイルが存在する。
試しに
<a href="http://www.mikihoshi.com/lily/">lily</a>に食わせてみると8分かかった。
巷でちらほら言われてる症状を確認した形になった。
</p>

<p>
一番時間がかかるのはlily.cgiのsortの部分。
</p>
<pre>
@storys.sort! {|f1,f2|
  get_post_time(f1) &lt;=&gt; get_post_time(f2)
}
</pre>
<p>
これを
</p>
<pre>
@storys = @storys.sort_by {|f| get_post_time(f)}
</pre>
<p>
とすれば1分になる。でもまだまだ苦しい。
</p>

<p>
本家blosxomはどんなもんだろう？
</p>

<!-- section end -->
</div>

<div class="entry0">
<h3><a name="200405092" title="200405092" href="200405a.html#200405092">■</a> 
[Perl] Blosxomを試す</h3>
<p>
3.0がそろそろ出そうだが、lilyが参考にした2.0を試そう。
</p>

<p>
$datadirだけいじる。http serverは
</p>
<pre>
#! /usr/local/bin/ruby

require 'webrick'

httpd = WEBrick::HTTPServer.new(:DocumentRoot=&gt;&quot;.&quot;, :Port=&gt;10080)
trap(:INT) do
  httpd.shutdown
end
httpd.start
</pre>
<p>
と簡単なもの。用意したデータは
</p>
<pre>
% find . -name '*.txt' |wc -l
   1120
</pre>
<p>
とやはり1000を越えていた。これで
</p>
<pre>
% time wget -q -O /dev/null http://localhost:10080/bloxsom.cgi
</pre>
<p>
としてみると0.4秒だった。そのくらいの時間ならまったく問題ない。
</p>

<!-- section end -->
</div>

<div class="entry1">
<h3><a name="200405093" title="200405093" href="200405a.html#200405093">■</a> 
[Ruby] lilyの.entrydateの更新</h3>
<p>
blosxom.cgiもsortしてるから、lilyが遅いのは.entrydateのせいだろうか？
試しにget_post_time()をFile::stat(file).mtimeだけにしてみると0.15秒になった。
なるほど。.entrydateの更新をなんとかすればいいわけだな。
</p>

<p>
dbmあたりで書き換えると
</p>
<pre>
require 'dbm'
def get_post_time(file)
  @dbm ||= DBM.open(&quot;#{@datadir}/.entry&quot;)
  if @dbm[file]
    mtime = Marshal.load @dbm[file]
  else
    mtime = File::stat(file).mtime
    @dbm[file] = Marshal.dump mtime
  end
  return mtime
end
</pre>
<p>
0.2秒ぐらいになった。あ、排他処理も入れないとやばいな。
</p>

<p>
まとめると、ファイルの数が多くなると遅くなるのは
</p>

</p><ol>
<li>sort_byではなくsortを使っている

<li>ファイルのopen/closeの繰り返し

<li>ptimesがHashではなくArray

</ol><p>
<p>
というあたりが原因。
</p>

<p>
<a href="../files/lily-0.1.4-for-ruby-1.9.diff">lily-0.1.4-for-ruby-1.9.diff</a></p>
<!-- section end -->
</div>
<!-- 2004/05/09 end -->



<hr class="hide">
<!-- 2004/05/10 start -->
<h2><a name="20040510" href="200405a.html#20040510">2004-05-10 (Mon)</a></h2>

<div class="entry1">
<h3><a name="200405101" title="200405101" href="200405a.html#200405101">■</a> 
[Mail] MSN?からのメール</h3>
<p>
最近SubjectにMSNという文字列で始まるメールが頻繁にやってくるけど、これって一体なんだろう？
HTMLメールは基本的に中身を見ないから、なんだかさっぱりわからん。
エラーメールもあるみたいだしなあ。
</p>

<p>
とりあえず、~/.procmailrcを
</p>
<pre>
:0
* ^Subject: MSN 
$SPAMDIR/.
</pre>
<p>
としとこう。
</p>

<!-- section end -->
</div>

<div class="entry0">
<h3><a name="200405102" title="200405102" href="200405a.html#200405102">■</a> 
[Mail] ご請求</h3>
<p>
Subjectに「ご請求」と書かれたメールが来た。
また最終通告かと思ったら、本物だった。
そうか、inetd.co.jpも今月いっぱいか。どうしようかな。
</p>
<!-- section end -->
</div>
<!-- 2004/05/10 end -->

<hr>
<div>
<a href="200404c.html">&lt;Prev(,)</a> | 
<a href="200405b.html">Next(.)&gt;</a> | 
<a href="index.html">Recent(/)&gt;&gt;</a>
| <a href="index.rdf">RDF</a>
</div>

<hr>
<!-- SiteSearch Google -->
<form method=GET action="https://www.google.co.jp/search">
<p>
<input type=text name=q size=31 maxlength=255 value="">
<input type=hidden name=hl value="ja">
<input type=hidden name=ie value="UTF-8">
<input type=submit name=btnG value="Google 検索">
<input type=hidden name=domains value="jarp.does.notwork.org"><br>
<input type=radio name=sitesearch value=""> WWW を検索
<input type=radio name=sitesearch value="jarp.does.notwork.org" checked> jarp.does.notwork.org を検索 <br>
</form>

<!-- nsmm v0.6.3.2(2005/08/18) -->

<address><a href="&#109;&#x61;&#x69;&#108;&#116;&#111;&#x3A;&#101;&#98;&#x61;&#110;&#64;&#x6F;&#x73;&#x2E;&#x72;&#105;&#109;&#46;&#x6F;&#x72;&#x2E;&#106;&#x70;">わたなべひろふみ</a><br>
Key fingerprint = C456 1350 085F A320 C6C8  8A36 0F15 9B2E EB12 3885<br>
      <a href="http://validator.w3.org/check?uri=referer"><img
          src="http://www.w3.org/Icons/valid-html401"
          alt="Valid HTML 4.01!" height="16" width="88"></a>

<script type="text/javascript" src="http://trackfeed.com/usr/aa7471e560.js"></script>
</address>

<script src="https://www.google-analytics.com/urchin.js" type="text/javascript">
</script>
<script type="text/javascript">
<!--
_uacct = "UA-101613-1";
urchinTracker();
// -->
</script>
<script src="title.js" type="text/javascript">
</script>
</body>
</html>
